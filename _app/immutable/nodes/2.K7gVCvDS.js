import{c as On,l as xn,m as An,a as p,d as R,f as U,o as qe,j as Dn}from"../chunks/W4OKvgJ1.js";import{w as yt,o as Qt,a as Pn}from"../chunks/sST61MHv.js";import{a as ft,H as en,aW as tn,S as st,h as pe,a0 as nn,I as ht,l as s,ap as Un,af as Ln,K as zn,U as Ht,a4 as dt,e as Be,J as Rn,a9 as Hn,R as jt,c as jn,aX as Le,b as Ot,s as Fn,C as Ft,ag as A,a7 as At,aM as qn,aY as Vn,aZ as Bn,a_ as Wn,r as sn,p as an,a$ as Nt,F as Jn,a2 as Gn,b0 as Yn,a6 as Kn,d as Xn,b1 as Zn,X as Qn,b2 as es,G as ts,ah as ns,t as Ee,x as Ie,A as E,y as f,i as q,n as P,z as u,v as D,aJ as me,b3 as rn,b4 as z,b5 as Pe,w as Y,ai as N,aH as qt,an as ss,T as as}from"../chunks/DCd_uAEE.js";import{s as x}from"../chunks/mw6dDeEP.js";import{l as ee,p as L,s as re,i as V,a as Te,b as ue,c as on}from"../chunks/CUWMNtGJ.js";import{a as Vt,b as De,s as ut,c as rs,d as is}from"../chunks/CCIW6Yut.js";import"../chunks/DNsPaE8R.js";import{i as Ne}from"../chunks/BQsvaV8x.js";import{B as os}from"../chunks/-W29c7Qh.js";function We(n,e){return e}function ls(n,e,a){for(var r=[],i=e.length,o,t=e.length,l=0;l<i;l++){let v=e[l];an(v,()=>{if(o){if(o.pending.delete(v),o.done.add(v),o.pending.size===0){var _=n.outrogroups;xt(At(o.done)),_.delete(o),_.size===0&&(n.outrogroups=null)}}else t-=1},!1)}if(t===0){var c=r.length===0&&a!==null;if(c){var d=a,g=d.parentNode;Kn(g),g.append(d),n.items.clear()}xt(e,!c)}else o={pending:new Set(e),done:new Set},(n.outrogroups??=new Set).add(o)}function xt(n,e=!0){for(var a=0;a<n.length;a++)Xn(n[a],e)}var Bt;function Je(n,e,a,r,i,o=null){var t=n,l=new Map,c=(e&tn)!==0;if(c){var d=n;t=pe?st(nn(d)):d.appendChild(ft())}pe&&ht();var g=null,v=Un(()=>{var b=a();return qn(b)?b:b==null?[]:At(b)}),_,w=!0;function k(){h.fallback=g,cs(h,_,t,e,r),g!==null&&(_.length===0?(g.f&Le)===0?sn(g):(g.f^=Le,ct(g,null,t)):an(g,()=>{g=null}))}var S=en(()=>{_=s(v);var b=_.length;let B=!1;if(pe){var Q=Ln(t)===zn;Q!==(b===0)&&(t=Ht(),st(t),dt(!1),B=!0)}for(var H=new Set,te=jn,oe=Fn(),G=0;G<b;G+=1){pe&&Be.nodeType===Rn&&Be.data===Hn&&(t=Be,B=!0,dt(!1));var le=_[G],X=r(le,G),K=w?null:l.get(X);K?(K.v&&jt(K.v,le),K.i&&jt(K.i,G),oe&&te.skipped_effects.delete(K.e)):(K=ds(l,w?t:Bt??=ft(),le,X,G,i,e,a),w||(K.e.f|=Le),l.set(X,K)),H.add(X)}if(b===0&&o&&!g&&(w?g=Ot(()=>o(t)):(g=Ot(()=>o(Bt??=ft())),g.f|=Le)),pe&&b>0&&st(Ht()),!w)if(oe){for(const[M,I]of l)H.has(M)||te.skipped_effects.add(I.e);te.oncommit(k),te.ondiscard(()=>{})}else k();B&&dt(!0),s(v)}),h={effect:S,items:l,outrogroups:null,fallback:g};w=!1,pe&&(t=Be)}function cs(n,e,a,r,i){var o=(r&Yn)!==0,t=e.length,l=n.items,c=n.effect.first,d,g=null,v,_=[],w=[],k,S,h,b;if(o)for(b=0;b<t;b+=1)k=e[b],S=i(k,b),h=l.get(S).e,(h.f&Le)===0&&(h.nodes?.a?.measure(),(v??=new Set).add(h));for(b=0;b<t;b+=1){if(k=e[b],S=i(k,b),h=l.get(S).e,n.outrogroups!==null)for(const K of n.outrogroups)K.pending.delete(h),K.done.delete(h);if((h.f&Le)!==0)if(h.f^=Le,h===c)ct(h,null,a);else{var B=g?g.next:c;h===n.effect.last&&(n.effect.last=h.prev),h.prev&&(h.prev.next=h.next),h.next&&(h.next.prev=h.prev),Fe(n,g,h),Fe(n,h,B),ct(h,B,a),g=h,_=[],w=[],c=g.next;continue}if((h.f&Nt)!==0&&(sn(h),o&&(h.nodes?.a?.unfix(),(v??=new Set).delete(h))),h!==c){if(d!==void 0&&d.has(h)){if(_.length<w.length){var Q=w[0],H;g=Q.prev;var te=_[0],oe=_[_.length-1];for(H=0;H<_.length;H+=1)ct(_[H],Q,a);for(H=0;H<w.length;H+=1)d.delete(w[H]);Fe(n,te.prev,oe.next),Fe(n,g,te),Fe(n,oe,Q),c=Q,g=oe,b-=1,_=[],w=[]}else d.delete(h),ct(h,c,a),Fe(n,h.prev,h.next),Fe(n,h,g===null?n.effect.first:g.next),Fe(n,g,h),g=h;continue}for(_=[],w=[];c!==null&&c!==h;)(d??=new Set).add(c),w.push(c),c=c.next;if(c===null)continue}(h.f&Le)===0&&_.push(h),g=h,c=h.next}if(n.outrogroups!==null){for(const K of n.outrogroups)K.pending.size===0&&(xt(At(K.done)),n.outrogroups?.delete(K));n.outrogroups.size===0&&(n.outrogroups=null)}if(c!==null||d!==void 0){var G=[];if(d!==void 0)for(h of d)(h.f&Nt)===0&&G.push(h);for(;c!==null;)(c.f&Nt)===0&&c!==n.fallback&&G.push(c),c=c.next;var le=G.length;if(le>0){var X=(r&tn)!==0&&t===0?a:null;if(o){for(b=0;b<le;b+=1)G[b].nodes?.a?.measure();for(b=0;b<le;b+=1)G[b].nodes?.a?.fix()}ls(n,G,X)}}o&&Jn(()=>{if(v!==void 0)for(h of v)h.nodes?.a?.apply()})}function ds(n,e,a,r,i,o,t,l){var c=(t&Vn)!==0?(t&Bn)===0?A(a,!1,!1):Ft(a):null,d=(t&Wn)!==0?Ft(i):null;return{v:c,i:d,e:Ot(()=>(o(e,c??a,d??i,l),()=>{n.delete(r)}))}}function ct(n,e,a){if(n.nodes)for(var r=n.nodes.start,i=n.nodes.end,o=e&&(e.f&Le)===0?e.nodes.start:a;r!==null;){var t=Gn(r);if(o.before(r),r===i)return;r=t}}function Fe(n,e,a){e===null?n.effect.first=a:e.next=a,a===null?n.effect.last=e:a.prev=e}function se(n,e,a,r,i){pe&&ht();var o=e.$$slots?.[a],t=!1;o===!0&&(o=e.children,t=!0),o===void 0||o(n,t?()=>r:r)}function us(n,e,a,r,i,o){let t=pe;pe&&ht();var l=null;pe&&Be.nodeType===Zn&&(l=Be,ht());var c=pe?Be:n,d=new os(c,!1);en(()=>{const g=e()||null;var v=es;if(g===null){d.ensure(null,null);return}return d.ensure(g,_=>{if(g){if(l=pe?l:document.createElementNS(v,g),On(l,l),r){pe&&xn(g)&&l.append(document.createComment(""));var w=pe?nn(l):l.appendChild(ft());pe&&(w===null?dt(!1):st(w)),r(l,w)}ts.nodes.end=l,_.before(l)}pe&&st(_)}),()=>{}},Qn),ns(()=>{}),t&&(dt(!0),st(c))}const vs=1,gt=2,Ct=3,Dt=4,fs=5,hs=6;function gs(n){return{type:"auth",access_token:n}}function _s(){return{type:"supported_features",id:1,features:{coalesce_messages:1}}}function ms(){return{type:"get_states"}}function ps(n,e,a,r,i){const o={type:"call_service",domain:n,service:e,target:r,return_response:i};return a&&(o.service_data=a),o}function ys(n){const e={type:"subscribe_events"};return n&&(e.event_type=n),e}function Wt(n){return{type:"unsubscribe_events",subscription:n}}function bs(){return{type:"ping"}}function $s(n,e){return{type:"result",success:!1,error:{code:n,message:e}}}function ws(n){const e={},a=n.split("&");for(let r=0;r<a.length;r++){const i=a[r].split("="),o=decodeURIComponent(i[0]),t=i.length>1?decodeURIComponent(i[1]):void 0;e[o]=t}return e}const ln=(n,e,a,r)=>{const[i,o,t]=n.split(".",3);return Number(i)>e||Number(i)===e&&(r===void 0?Number(o)>=a:Number(o)>a)||r!==void 0&&Number(i)===e&&Number(o)===a&&Number(t)>=r},ks="auth_invalid",Es="auth_ok";function Is(n){if(!n.auth)throw Dt;const e=n.auth;let a=e.expired?e.refreshAccessToken().then(()=>{a=void 0},()=>{a=void 0}):void 0;const r=e.wsUrl;function i(o,t,l){const c=new WebSocket(r);let d=!1;const g=()=>{if(c.removeEventListener("close",g),d){l(gt);return}if(o===0){l(vs);return}const w=o===-1?-1:o-1;setTimeout(()=>i(w,t,l),1e3)},v=async w=>{try{e.expired&&await(a||e.refreshAccessToken()),c.send(JSON.stringify(gs(e.accessToken)))}catch(k){d=k===gt,c.close()}},_=async w=>{const k=JSON.parse(w.data);switch(k.type){case ks:d=!0,c.close();break;case Es:c.removeEventListener("open",v),c.removeEventListener("message",_),c.removeEventListener("close",g),c.removeEventListener("error",g),c.haVersion=k.ha_version,ln(c.haVersion,2022,9)&&c.send(JSON.stringify(_s())),t(c);break}};c.addEventListener("open",v),c.addEventListener("message",_),c.addEventListener("close",g),c.addEventListener("error",g)}return new Promise((o,t)=>i(n.setupRetry,o,t))}class Ss{constructor(e,a){this._handleMessage=r=>{let i=JSON.parse(r.data);Array.isArray(i)||(i=[i]),i.forEach(o=>{const t=this.commands.get(o.id);switch(o.type){case"event":t?t.callback(o.event):(console.warn(`Received event for unknown subscription ${o.id}. Unsubscribing.`),this.sendMessagePromise(Wt(o.id)).catch(l=>{}));break;case"result":t&&(o.success?(t.resolve(o.result),"subscribe"in t||this.commands.delete(o.id)):(t.reject(o.error),this.commands.delete(o.id)));break;case"pong":t?(t.resolve(),this.commands.delete(o.id)):console.warn(`Received unknown pong response ${o.id}`);break}})},this._handleClose=async()=>{const r=this.commands;if(this.commandId=1,this.oldSubscriptions=this.commands,this.commands=new Map,this.socket=void 0,r.forEach(t=>{"subscribe"in t||t.reject($s(Ct,"Connection lost"))}),this.closeRequested)return;this.fireEvent("disconnected");const i=Object.assign(Object.assign({},this.options),{setupRetry:0}),o=t=>{setTimeout(async()=>{if(!this.closeRequested)try{const l=await i.createSocket(i);this._setSocket(l)}catch(l){if(this._queuedMessages){const c=this._queuedMessages;this._queuedMessages=void 0;for(const d of c)d.reject&&d.reject(Ct)}l===gt?this.fireEvent("reconnect-error",l):o(t+1)}},Math.min(t,5)*1e3)};this.suspendReconnectPromise&&(await this.suspendReconnectPromise,this.suspendReconnectPromise=void 0,this._queuedMessages=[]),o(0)},this.options=a,this.commandId=2,this.commands=new Map,this.eventListeners=new Map,this.closeRequested=!1,this._setSocket(e)}get connected(){return this.socket!==void 0&&this.socket.readyState==this.socket.OPEN}_setSocket(e){this.socket=e,this.haVersion=e.haVersion,e.addEventListener("message",this._handleMessage),e.addEventListener("close",this._handleClose);const a=this.oldSubscriptions;a&&(this.oldSubscriptions=void 0,a.forEach(i=>{"subscribe"in i&&i.subscribe&&i.subscribe().then(o=>{i.unsubscribe=o,i.resolve()})}));const r=this._queuedMessages;if(r){this._queuedMessages=void 0;for(const i of r)i.resolve()}this.fireEvent("ready")}addEventListener(e,a){let r=this.eventListeners.get(e);r||(r=[],this.eventListeners.set(e,r)),r.push(a)}removeEventListener(e,a){const r=this.eventListeners.get(e);if(!r)return;const i=r.indexOf(a);i!==-1&&r.splice(i,1)}fireEvent(e,a){(this.eventListeners.get(e)||[]).forEach(r=>r(this,a))}suspendReconnectUntil(e){this.suspendReconnectPromise=e}suspend(){if(!this.suspendReconnectPromise)throw new Error("Suspend promise not set");this.socket&&this.socket.close()}reconnect(e=!1){if(this.socket){if(!e){this.socket.close();return}this.socket.removeEventListener("message",this._handleMessage),this.socket.removeEventListener("close",this._handleClose),this.socket.close(),this._handleClose()}}close(){this.closeRequested=!0,this.socket&&this.socket.close()}async subscribeEvents(e,a){return this.subscribeMessage(e,ys(a))}ping(){return this.sendMessagePromise(bs())}sendMessage(e,a){if(!this.connected)throw Ct;if(this._queuedMessages){if(a)throw new Error("Cannot queue with commandId");this._queuedMessages.push({resolve:()=>this.sendMessage(e)});return}a||(a=this._genCmdId()),e.id=a,this.socket.send(JSON.stringify(e))}sendMessagePromise(e){return new Promise((a,r)=>{if(this._queuedMessages){this._queuedMessages.push({reject:r,resolve:async()=>{try{a(await this.sendMessagePromise(e))}catch(o){r(o)}}});return}const i=this._genCmdId();this.commands.set(i,{resolve:a,reject:r}),this.sendMessage(e,i)})}async subscribeMessage(e,a,r){if(this._queuedMessages&&await new Promise((o,t)=>{this._queuedMessages.push({resolve:o,reject:t})}),r?.preCheck&&!await r.preCheck())throw new Error("Pre-check failed");let i;return await new Promise((o,t)=>{const l=this._genCmdId();i={resolve:o,reject:t,callback:e,subscribe:r?.resubscribe!==!1?()=>this.subscribeMessage(e,a,r):void 0,unsubscribe:async()=>{this.connected&&await this.sendMessagePromise(Wt(l)),this.commands.delete(l)}},this.commands.set(l,i);try{this.sendMessage(a,l)}catch{}}),()=>i.unsubscribe()}_genCmdId(){return++this.commandId}}const Ms=()=>`${location.protocol}//${location.host}/`,Ts=n=>n*1e3+Date.now();function Ns(){const{protocol:n,host:e,pathname:a,search:r}=location;return`${n}//${e}${a}${r}`}function Cs(n,e,a,r){let i=`${n}/auth/authorize?response_type=code&redirect_uri=${encodeURIComponent(a)}`;return e!==null&&(i+=`&client_id=${encodeURIComponent(e)}`),r&&(i+=`&state=${encodeURIComponent(r)}`),i}function Os(n,e,a,r){a+=(a.includes("?")?"&":"?")+"auth_callback=1",document.location.href=Cs(n,e,a,r)}async function cn(n,e,a){const r=typeof location<"u"&&location;if(r&&r.protocol==="https:"){const l=document.createElement("a");if(l.href=n,l.protocol==="http:"&&l.hostname!=="localhost")throw fs}const i=new FormData;e!==null&&i.append("client_id",e),Object.keys(a).forEach(l=>{i.append(l,a[l])});const o=await fetch(`${n}/auth/token`,{method:"POST",credentials:"same-origin",body:i});if(!o.ok)throw o.status===400||o.status===403?gt:new Error("Unable to fetch tokens");const t=await o.json();return t.hassUrl=n,t.clientId=e,t.expires=Ts(t.expires_in),t}function Jt(n,e,a){return cn(n,e,{code:a,grant_type:"authorization_code"})}function xs(n){return btoa(JSON.stringify(n))}function As(n){return JSON.parse(atob(n))}class Ds{constructor(e,a){this.data=e,this._saveTokens=a}get wsUrl(){return`ws${this.data.hassUrl.substr(4)}/api/websocket`}get accessToken(){return this.data.access_token}get expired(){return Date.now()>this.data.expires}async refreshAccessToken(){if(!this.data.refresh_token)throw new Error("No refresh_token");const e=await cn(this.data.hassUrl,this.data.clientId,{grant_type:"refresh_token",refresh_token:this.data.refresh_token});e.refresh_token=this.data.refresh_token,this.data=e,this._saveTokens&&this._saveTokens(e)}async revoke(){if(!this.data.refresh_token)throw new Error("No refresh_token to revoke");const e=new FormData;e.append("token",this.data.refresh_token),await fetch(`${this.data.hassUrl}/auth/revoke`,{method:"POST",credentials:"same-origin",body:e}),this._saveTokens&&this._saveTokens(null)}}async function Ps(n={}){let e,a=n.hassUrl;a&&a[a.length-1]==="/"&&(a=a.substr(0,a.length-1));const r=n.clientId!==void 0?n.clientId:Ms(),i=n.limitHassInstance===!0;if(n.authCode&&a&&(e=await Jt(a,r,n.authCode),n.saveTokens&&n.saveTokens(e)),!e){const o=ws(location.search.substr(1));if("auth_callback"in o){const t=As(o.state);if(i&&(t.hassUrl!==a||t.clientId!==r))throw hs;e=await Jt(t.hassUrl,t.clientId,o.code),n.saveTokens&&n.saveTokens(e)}}if(!e&&n.loadTokens&&(e=await n.loadTokens()),e&&(a===void 0||e.hassUrl===a))return new Ds(e,n.saveTokens);if(a===void 0)throw Dt;return Os(a,r,n.redirectUrl||Ns(),xs({hassUrl:a,clientId:r})),new Promise(()=>{})}const Us=n=>{let e=[];function a(i){let o=[];for(let t=0;t<e.length;t++)e[t]===i?i=null:o.push(e[t]);e=o}function r(i,o){n=o?i:Object.assign(Object.assign({},n),i);let t=e;for(let l=0;l<t.length;l++)t[l](n)}return{get state(){return n},action(i){function o(t){r(t,!1)}return function(){let t=[n];for(let c=0;c<arguments.length;c++)t.push(arguments[c]);let l=i.apply(this,t);if(l!=null)return l instanceof Promise?l.then(o):o(l)}},setState:r,clearState(){n=void 0},subscribe(i){return e.push(i),()=>{a(i)}}}},Ls=5e3,Gt=(n,e,a,r,i={unsubGrace:!0})=>{if(n[e])return n[e];let o=0,t,l,c=Us();const d=()=>{if(!a)throw new Error("Collection does not support refresh");return a(n).then(S=>c.setState(S,!0))},g=()=>d().catch(S=>{if(n.connected)throw S}),v=()=>{if(l!==void 0){clearTimeout(l),l=void 0;return}r&&(t=r(n,c)),a&&(n.addEventListener("ready",g),g()),n.addEventListener("disconnected",k)},_=()=>{l=void 0,t&&t.then(S=>{S()}),c.clearState(),n.removeEventListener("ready",d),n.removeEventListener("disconnected",k)},w=()=>{l=setTimeout(_,Ls)},k=()=>{l&&(clearTimeout(l),_())};return n[e]={get state(){return c.state},refresh:d,subscribe(S){o++,o===1&&v();const h=c.subscribe(S);return c.state!==void 0&&setTimeout(()=>S(c.state),0),()=>{h(),o--,o||(i.unsubGrace?w():_())}}},n[e]},zs=n=>n.sendMessagePromise(ms()),ze=(n,e,a,r,i,o)=>n.sendMessagePromise(ps(e,a,r,i,o));function Rs(n,e){const a=Object.assign({},n.state);if(e.a)for(const r in e.a){const i=e.a[r];let o=new Date(i.lc*1e3).toISOString();a[r]={entity_id:r,state:i.s,attributes:i.a,context:typeof i.c=="string"?{id:i.c,parent_id:null,user_id:null}:i.c,last_changed:o,last_updated:i.lu?new Date(i.lu*1e3).toISOString():o}}if(e.r)for(const r of e.r)delete a[r];if(e.c)for(const r in e.c){let i=a[r];if(!i){console.warn("Received state update for unknown entity",r);continue}i=Object.assign({},i);const{"+":o,"-":t}=e.c[r],l=o?.a||t?.a,c=l?Object.assign({},i.attributes):i.attributes;if(o&&(o.s!==void 0&&(i.state=o.s),o.c&&(typeof o.c=="string"?i.context=Object.assign(Object.assign({},i.context),{id:o.c}):i.context=Object.assign(Object.assign({},i.context),o.c)),o.lc?i.last_updated=i.last_changed=new Date(o.lc*1e3).toISOString():o.lu&&(i.last_updated=new Date(o.lu*1e3).toISOString()),o.a&&Object.assign(c,o.a)),t?.a)for(const d of t.a)delete c[d];l&&(i.attributes=c),a[r]=i}n.setState(a,!0)}const Hs=(n,e)=>n.subscribeMessage(a=>Rs(e,a),{type:"subscribe_entities"});function js(n,e){const a=n.state;if(a===void 0)return;const{entity_id:r,new_state:i}=e.data;if(i)n.setState({[i.entity_id]:i});else{const o=Object.assign({},a);delete o[r],n.setState(o,!0)}}async function Fs(n){const e=await zs(n),a={};for(let r=0;r<e.length;r++){const i=e[r];a[i.entity_id]=i}return a}const qs=(n,e)=>n.subscribeEvents(a=>js(e,a),"state_changed"),Vs=n=>ln(n.haVersion,2022,4,0)?Gt(n,"_ent",void 0,Hs):Gt(n,"_ent",Fs,qs),Bs=(n,e)=>Vs(n).subscribe(e);async function Ws(n){const e=Object.assign({setupRetry:0,createSocket:Is},n),a=await e.createSocket(e);return new Ss(a,e)}const Ce=yt({}),Ae=yt(null),nt=yt(!1),Ve=yt(null);let Ue;function dn(){if(typeof window<"u")try{const n=window.location.origin;if(window.parent!==window)try{const e=window.parent.location.origin;if(e.includes(":8123")||e.includes("home-assistant")||e.includes("homeassistant"))return e}catch{if(n.includes(":8123")||n.includes("home-assistant")||n.includes("homeassistant"))return n}if(n.includes(":8123")||n.includes("home-assistant")||n.includes("homeassistant")||window.location.hostname.includes("homeassistant")||window.location.hostname.includes("home-assistant")||window.location.pathname.includes("/hacsfiles/")||window.location.pathname.includes("/local/"))return n}catch(n){console.error("Error detecting HA URL:",n)}if(typeof window<"u"){const n=localStorage.getItem("hassUrl");if(n)return n}return"http://homeassistant.local:8123"}function un(n){if(!n)return null;try{const e=dn();return new URL(n,e).href}catch(e){return console.error("Error building entity picture URL:",e),null}}async function Js(){if(typeof window<"u"){const n=localStorage.getItem("hassTokens");if(n)try{const e=JSON.parse(n);if(e.expires&&e.expires>Date.now())return e}catch{}}return null}async function Gs(n){typeof window<"u"&&(localStorage.setItem("hassTokens",JSON.stringify(n)),localStorage.setItem("hassUrl",n.hassUrl))}async function Ys(){try{const n=dn();console.log("Connecting to Home Assistant at:",n);const e=await Ps({hassUrl:n,loadTokens:Js,saveTokens:Gs});console.log("Authentication successful, creating connection..."),Ue=await Ws({auth:e}),console.log("Connection established via createConnection"),nt.set(!0),Ae.set(Ue),Ve.set(null),Bs(Ue,a=>{console.log("Received entity updates",Object.keys(a).length),Ce.set(a)}),Ue.addEventListener("ready",()=>{console.log("Connection ready event"),nt.set(!0),Ae.set(Ue),Ve.set(null)}),Ue.addEventListener("disconnected",()=>{console.log("Disconnected from Home Assistant"),nt.set(!1),Ae.set(null),Ve.set("Disconnected")}),Ue.addEventListener("reconnect-error",()=>{console.error("Reconnect error"),Ve.set("Reconnecting...")})}catch(n){console.error("Connection failed",n),nt.set(!1),n===Dt?Ve.set("Host required"):Ve.set(n.message||"Connection failed - Check console")}}async function Ks(n,e,a){const r=e||new Date,i=a||new Date(Date.now()+10080*60*1e3);if(console.log("Fetching calendar events:",{entityId:n,start:r.toISOString(),end:i.toISOString(),startDate:r.toLocaleString(),endDate:i.toLocaleString()}),Ue)try{let o=function(d,g=""){if(!d)return null;if(Array.isArray(d)){if(d.length===0)return null;const v=d[0];return v&&typeof v=="object"&&(v.summary||v.start||v.end||v.title)?(console.log(`Found event array at path: ${g} with ${d.length} events`),d):null}if(typeof d=="object"){for(const v in d)if(d.hasOwnProperty(v)){const _=o(d[v],g?`${g}.${v}`:v);if(_)return _}}return null};const t=await Ue.sendMessagePromise({type:"call_service",domain:"calendar",service:"get_events",service_data:{entity_id:n,start_date_time:r.toISOString(),end_date_time:i.toISOString()},return_response:!0});console.log("Calendar service result:",JSON.stringify(t,null,2)),console.log("Result type:",typeof t),console.log("Is array:",Array.isArray(t)),console.log("Entity ID:",n);const l=o(t);if(l)return console.log(`Found ${l.length} events recursively`),l;let c=null;if(t?.response){const d=t.response;if(console.log("Found result.response:",typeof d,Array.isArray(d)),Array.isArray(d))c=d,console.log("Response is array with",c.length,"events");else if(d&&typeof d=="object")if(d[n]&&Array.isArray(d[n]))c=d[n],console.log(`Found events in response.${n}:`,c.length,"events");else if(d.events&&Array.isArray(d.events))c=d.events,console.log("Found events in response.events:",c.length,"events");else{const g=Object.keys(d);console.log("Response keys:",g);for(const v of g)if(Array.isArray(d[v])&&d[v].length>0){const _=d[v][0];if(_&&typeof _=="object"&&(_.summary||_.start||_.end||_.title)){c=d[v],console.log(`Found event array in response.${v}:`,c.length,"events");break}}}}else if(Array.isArray(t)&&t.length>0){const d=t[0];d&&typeof d=="object"&&(d.summary||d.start||d.end||d.title)&&(c=t,console.log("Result is directly an array:",c.length,"events"))}else t?.events&&Array.isArray(t.events)?(c=t.events,console.log("Found events in result.events:",c.length,"events")):t&&typeof t=="object"&&t[n]&&Array.isArray(t[n])&&(c=t[n],console.log(`Found events in result.${n}:`,c.length,"events"));return Array.isArray(c)&&c.length>0?(console.log(`Returning ${c.length} events`),c[0]&&console.log("First event structure:",Object.keys(c[0])),c):(console.log("No events found in result structure"),console.log("Result keys:",t?Object.keys(t):"null"),t?.response&&typeof t.response=="object"&&console.log("Response keys:",Object.keys(t.response)),[])}catch(o){throw console.error("Service call failed:",o),new Error(`Calendar service error: ${o.message||o.code||"Unknown error"}`)}throw new Error("Not connected to Home Assistant. Calendar events require a websocket connection.")}const Xs={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Zs=An("<svg><!><!></svg>");function ie(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]),r=ee(a,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Ee(e,!1);let i=L(e,"name",8,void 0),o=L(e,"color",8,"currentColor"),t=L(e,"size",8,24),l=L(e,"strokeWidth",8,2),c=L(e,"absoluteStrokeWidth",8,!1),d=L(e,"iconNode",24,()=>[]);const g=(...k)=>k.filter((S,h,b)=>!!S&&b.indexOf(S)===h).join(" ");Ne();var v=Zs();Vt(v,(k,S)=>({...Xs,...r,width:t(),height:t(),stroke:o(),"stroke-width":k,class:S}),[()=>(P(c()),P(l()),P(t()),q(()=>c()?Number(l())*24/Number(t()):l())),()=>(P(i()),P(a),q(()=>g("lucide-icon","lucide",i()?`lucide-${i()}`:"",a.class)))]);var _=f(v);Je(_,1,d,We,(k,S)=>{var h=me(()=>rn(s(S),2));let b=()=>s(h)[0],B=()=>s(h)[1];var Q=R(),H=D(Q);us(H,b,!0,(te,oe)=>{Vt(te,()=>({...B()}))}),p(k,Q)});var w=E(_);se(w,e,"default",{}),u(v),p(n,v),Ie()}function _t(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2"}],["path",{d:"M10 4v4"}],["path",{d:"M2 8h20"}],["path",{d:"M6 4v4"}]];ie(n,re({name:"app-window"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function Qs(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M 22 14 L 22 10"}],["rect",{x:"2",y:"6",width:"16",height:"12",rx:"2"}]];ie(n,re({name:"battery"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function Yt(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M8 2v4"}],["path",{d:"M16 2v4"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2"}],["path",{d:"M3 10h18"}]];ie(n,re({name:"calendar"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function mt(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"m9 12 2 2 4-4"}]];ie(n,re({name:"circle-check"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function ea(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];ie(n,re({name:"circle-question-mark"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function Kt(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M12 6v6l4 2"}],["circle",{cx:"12",cy:"12",r:"10"}]];ie(n,re({name:"clock"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function vn(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M10 12h.01"}],["path",{d:"M18 20V6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14"}],["path",{d:"M2 20h20"}]];ie(n,re({name:"door-closed"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function fn(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M11 20H2"}],["path",{d:"M11 4.562v16.157a1 1 0 0 0 1.242.97L19 20V5.562a2 2 0 0 0-1.515-1.94l-4-1A2 2 0 0 0 11 4.561z"}],["path",{d:"M11 4H8a2 2 0 0 0-2 2v14"}],["path",{d:"M14 12h.01"}],["path",{d:"M22 20h-3"}]];ie(n,re({name:"door-open"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function hn(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z"}],["path",{d:"M16 17h4"}],["path",{d:"M4 13h4"}]];ie(n,re({name:"footprints"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function ta(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}]];ie(n,re({name:"house"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function gn(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M16.8 11.2c.8-.9 1.2-2 1.2-3.2a6 6 0 0 0-9.3-5"}],["path",{d:"m2 2 20 20"}],["path",{d:"M6.3 6.3a4.67 4.67 0 0 0 1.2 5.2c.7.7 1.3 1.5 1.5 2.5"}],["path",{d:"M9 18h6"}],["path",{d:"M10 22h4"}]];ie(n,re({name:"lightbulb-off"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function na(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"}],["path",{d:"M9 18h6"}],["path",{d:"M10 22h4"}]];ie(n,re({name:"lightbulb"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function sa(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"}],["circle",{cx:"12",cy:"10",r:"3"}]];ie(n,re({name:"map-pin"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function aa(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"}]];ie(n,re({name:"moon"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function Xt(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1"}]];ie(n,re({name:"pause"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function Zt(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z"}]];ie(n,re({name:"play"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function ra(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M12 22v-5"}],["path",{d:"M15 8V2"}],["path",{d:"M17 8a1 1 0 0 1 1 1v4a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1z"}],["path",{d:"M9 8V2"}]];ie(n,re({name:"plug"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function Pt(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M12 2v10"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04"}]];ie(n,re({name:"power"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function ia(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z"}],["path",{d:"M3 20V4"}]];ie(n,re({name:"skip-back"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function oa(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M21 4v16"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z"}]];ie(n,re({name:"skip-forward"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function la(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]];ie(n,re({name:"sun"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function ca(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M3.5 21 14 3"}],["path",{d:"M20.5 21 10 3"}],["path",{d:"M15.5 21 12 15l-3.5 6"}],["path",{d:"M2 21h20"}]];ie(n,re({name:"tent"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function da(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"}]];ie(n,re({name:"thermometer"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function _n(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]];ie(n,re({name:"triangle-alert"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function ua(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"m17 2-5 5-5-5"}],["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2"}]];ie(n,re({name:"tv"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}function pt(n,e){const a=ee(e,["children","$$slots","$$events","$$legacy"]);const r=[["path",{d:"M18 21V10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1v11"}],["path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 1.132-1.803l7.95-3.974a2 2 0 0 1 1.837 0l7.948 3.974A2 2 0 0 1 22 8z"}],["path",{d:"M6 13h12"}],["path",{d:"M6 17h12"}]];ie(n,re({name:"warehouse"},()=>a,{get iconNode(){return r},children:(i,o)=>{var t=R(),l=D(t);se(l,e,"default",{}),p(i,t)},$$slots:{default:!0}}))}var va=U('<div><div class="icon svelte-1ds1j5k"><!></div> <div class="name svelte-1ds1j5k"> </div> <div class="state svelte-1ds1j5k"> </div></div>');function fa(n,e){Ee(e,!1);const a=()=>ue(Ce,"$entities",i),r=()=>ue(Ae,"$connection",i),[i,o]=Te(),t=A(),l=A();let c=L(e,"entityId",8),d=L(e,"label",8);function g(){r()&&ze(r(),"homeassistant","toggle",{entity_id:c()})}z(()=>(a(),P(c())),()=>{N(t,a()[c()])}),z(()=>s(t),()=>{N(l,s(t)?.state==="on")}),Pe(),Ne();var v=va(),_=f(v),w=f(_);{var k=H=>{na(H,{size:32})},S=H=>{gn(H,{size:32})};V(w,H=>{s(l)?H(k):H(S,!1)})}u(_);var h=E(_,2),b=f(h,!0);u(h);var B=E(h,2),Q=f(B,!0);u(B),u(v),Y(()=>{De(v,1,`tile ${s(l)?"on":"off"} glass-panel`,"svelte-1ds1j5k"),x(b,(P(d()),s(t),P(c()),q(()=>d()||s(t)?.attributes.friendly_name||c()))),x(Q,(s(t),q(()=>s(t)?.state||"Unknown")))}),qe("click",v,g),p(n,v),Ie(),o()}var ha=U('<div class="tile sensor glass-panel svelte-1mck596"><div class="header svelte-1mck596"> </div> <div class="value svelte-1mck596"> <span class="unit svelte-1mck596"> </span></div></div>');function ga(n,e){Ee(e,!1);const a=()=>ue(Ce,"$entities",r),[r,i]=Te(),o=A(),t=A(),l=A(),c=A();let d=L(e,"entityId",8),g=L(e,"label",8),v=L(e,"format",8,""),_=L(e,"unit",8,"");z(()=>(a(),P(d())),()=>{N(o,a()[d()])}),z(()=>s(o),()=>{N(t,s(o)?.state)}),z(()=>(P(_()),s(o)),()=>{N(l,_()||s(o)?.attributes.unit_of_measurement||"")}),z(()=>(P(v()),s(t)),()=>{N(c,v()==="date"&&s(t)?new Date(s(t)).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}):s(t))}),Pe(),Ne();var w=ha(),k=f(w),S=f(k,!0);u(k);var h=E(k,2),b=f(h),B=E(b),Q=f(B,!0);u(B),u(h),u(w),Y(()=>{x(S,(P(g()),s(o),P(d()),q(()=>g()||s(o)?.attributes.friendly_name||d()))),x(b,`${(s(c)||"--")??""} `),x(Q,s(l))}),p(n,w),Ie(),i()}var _a=U('<div><div class="header svelte-d2lh25"> </div> <div class="content svelte-d2lh25"><span class="icon svelte-d2lh25"><!></span> <span class="state svelte-d2lh25"> </span></div></div>');function ma(n,e){Ee(e,!1);const a=()=>ue(Ce,"$entities",r),[r,i]=Te(),o=A(),t=A(),l=A(),c=A(),d=A();let g=L(e,"entityId",8),v=L(e,"label",8),_=L(e,"deviceClass",8,"door");function w(X){switch(X){case"door":return"Open";case"window":return"Open";case"motion":return"Detected";case"garage":return"Open";case"problem":return"Problem";default:return"On"}}function k(X){switch(X){case"door":return"Closed";case"window":return"Closed";case"motion":return"Clear";case"garage":return"Closed";case"problem":return"OK";default:return"Off"}}function S(X){switch(X){case"door":return fn;case"window":return _t;case"motion":return hn;case"garage":return pt;default:return _n}}function h(X){switch(X){case"door":return vn;case"window":return _t;case"motion":return mt;case"garage":return pt;default:return mt}}z(()=>(a(),P(g())),()=>{N(o,a()[g()])}),z(()=>s(o),()=>{N(t,s(o)?.state)}),z(()=>s(t),()=>{N(l,s(t)==="on")}),z(()=>(s(l),P(_())),()=>{N(c,s(l)?w(_()):k(_()))}),z(()=>(s(l),P(_())),()=>{N(d,s(l)?S(_()):h(_()))}),Pe(),Ne();var b=_a(),B=f(b),Q=f(B,!0);u(B);var H=E(B,2),te=f(H),oe=f(te);on(oe,()=>s(d),(X,K)=>{K(X,{size:24})}),u(te);var G=E(te,2),le=f(G,!0);u(G),u(H),u(b),Y(()=>{De(b,1,`tile ${s(l)?"active":"inactive"} glass-panel`,"svelte-d2lh25"),x(Q,(P(v()),s(o),P(g()),q(()=>v()||s(o)?.attributes.friendly_name||g()))),x(le,s(c))}),p(n,b),Ie(),i()}var pa=U('<div><div class="icon svelte-h88ioc"><!></div> <div class="name svelte-h88ioc"> </div> <div class="state svelte-h88ioc"> </div></div>');function ya(n,e){Ee(e,!1);const a=()=>ue(Ce,"$entities",i),r=()=>ue(Ae,"$connection",i),[i,o]=Te(),t=A(),l=A();let c=L(e,"entityId",8),d=L(e,"label",8);function g(){r()&&ze(r(),"homeassistant","toggle",{entity_id:c()})}z(()=>(a(),P(c())),()=>{N(t,a()[c()])}),z(()=>s(t),()=>{N(l,s(t)?.state==="on")}),Pe(),Ne();var v=pa(),_=f(v),w=f(_);ra(w,{size:32}),u(_);var k=E(_,2),S=f(k,!0);u(k);var h=E(k,2),b=f(h,!0);u(h),u(v),Y(()=>{De(v,1,`tile ${s(l)?"on":"off"} glass-panel`,"svelte-h88ioc"),x(S,(P(d()),s(t),P(c()),q(()=>d()||s(t)?.attributes.friendly_name||c()))),x(b,(s(t),q(()=>s(t)?.state||"Unknown")))}),qe("click",v,g),p(n,v),Ie(),o()}var ba=U('<img class="avatar svelte-1kgjbrn"/>'),$a=U('<span class="icon svelte-1kgjbrn"><!></span>'),wa=U('<div class="battery svelte-1kgjbrn"><span><!></span> <span> </span></div>'),ka=U('<div><div class="icon-area svelte-1kgjbrn"><!></div> <div class="info svelte-1kgjbrn"><div class="name svelte-1kgjbrn"> </div> <div class="state svelte-1kgjbrn"> </div> <!></div></div>');function Ea(n,e){Ee(e,!1);const a=()=>ue(Ce,"$entities",r),[r,i]=Te(),o=A(),t=A(),l=A(),c=A(),d=A(),g=A(),v=A(),_=A();let w=L(e,"entityId",8),k=L(e,"label",8),S=L(e,"batteryEntityId",8,void 0);z(()=>(a(),P(w())),()=>{N(o,a()[w()])}),z(()=>s(o),()=>{N(t,s(o)?.state)}),z(()=>s(t),()=>{N(l,s(t)==="home")}),z(()=>s(o),()=>{N(c,s(o)?.attributes.entity_picture)}),z(()=>s(c),()=>{N(d,un(s(c)))}),z(()=>(P(S()),a()),()=>{N(g,S()?a()[S()]:null)}),z(()=>s(g),()=>{N(v,(()=>{if(!s(g)||!s(g).state||s(g).state==="unavailable"||s(g).state==="unknown")return null;const I=parseFloat(s(g).state);return isNaN(I)?null:I})())}),z(()=>s(g),()=>{N(_,s(g)?.attributes.unit_of_measurement||"%")}),z(()=>(P(S()),s(g),a(),s(v),s(_)),()=>{S()&&(s(g)?console.log(`Battery entity ${S()}:`,{state:s(g).state,level:s(v),unit:s(_)}):console.warn(`Battery entity "${S()}" not found in entities. Available entities:`,Object.keys(a()).filter(I=>I.includes("battery")||I.includes("phone"))))}),Pe(),Ne();var h=ka(),b=f(h),B=f(b);{var Q=I=>{var m=ba();Y(()=>{ut(m,"src",s(d)),ut(m,"alt",k())}),p(I,m)},H=I=>{var m=$a(),y=f(m);{var T=j=>{ta(j,{size:24})},Z=j=>{ca(j,{size:24})};V(y,j=>{s(l)?j(T):j(Z,!1)})}u(m),p(I,m)};V(B,I=>{s(d)?I(Q):I(H,!1)})}u(b);var te=E(b,2),oe=f(te),G=f(oe,!0);u(oe);var le=E(oe,2),X=f(le,!0);u(le);var K=E(le,2);{var M=I=>{var m=wa(),y=f(m);let T;var Z=f(y);Qs(Z,{size:14}),u(y);var j=E(y,2),F=f(j);u(j),u(m),Y(J=>{T=De(y,1,"battery-icon svelte-1kgjbrn",null,T,{low:s(v)<20}),x(F,`${J??""}${s(_)??""}`)},[()=>(s(v),q(()=>Math.round(s(v))))]),p(I,m)};V(K,I=>{s(v)!==null&&I(M)})}u(te),u(h),Y(()=>{De(h,1,`tile ${s(l)?"home":"away"} glass-panel`,"svelte-1kgjbrn"),x(G,(P(k()),s(o),P(w()),q(()=>k()||s(o)?.attributes.friendly_name||w()))),x(X,s(t)||"Unknown")}),p(n,h),Ie(),i()}var Ia=U('<div class="artist svelte-l11nk0"> </div>'),Sa=U('<div class="temperature svelte-l11nk0"><!> </div>'),Ma=U('<div><div class="bg-overlay svelte-l11nk0"></div> <div class="content svelte-l11nk0"><div class="header svelte-l11nk0"><div class="header-left svelte-l11nk0"><span class="icon"><!></span> <span class="label"> </span></div> <div class="header-right svelte-l11nk0"><button class="btn-icon power svelte-l11nk0"><!></button></div></div> <div class="info svelte-l11nk0"><div class="text-info"><div class="title svelte-l11nk0"> </div> <!></div> <div class="controls svelte-l11nk0"><!> <button class="btn-control svelte-l11nk0"><!></button> <button class="btn-control play-pause svelte-l11nk0"><!></button> <button class="btn-control svelte-l11nk0"><!></button></div></div></div></div>');function Ta(n,e){Ee(e,!1);const a=()=>ue(Ce,"$entities",i),r=()=>ue(Ae,"$connection",i),[i,o]=Te(),t=A(),l=A(),c=A(),d=A(),g=A(),v=A(),_=A(),w=A(),k=A(),S=A();let h=L(e,"entityId",8),b=L(e,"label",8),B=L(e,"temperatureEntityId",8,void 0);function Q(W){W.stopPropagation(),r()&&ze(r(),"media_player","media_play_pause",{entity_id:h()})}function H(W){W.stopPropagation(),r()&&ze(r(),"media_player","media_next_track",{entity_id:h()})}function te(W){W.stopPropagation(),r()&&ze(r(),"media_player","media_previous_track",{entity_id:h()})}function oe(W){W.stopPropagation(),r()&&ze(r(),"media_player","toggle",{entity_id:h()})}z(()=>(a(),P(h())),()=>{N(t,a()[h()])}),z(()=>s(t),()=>{N(l,s(t)?.state)}),z(()=>s(l),()=>{N(c,s(l)==="playing")}),z(()=>s(t),()=>{N(d,s(t)?.attributes||{})}),z(()=>s(d),()=>{N(g,s(d).media_title||s(d).source||"No Media")}),z(()=>s(d),()=>{N(v,s(d).media_artist||s(d).media_series_title||"")}),z(()=>s(d),()=>{N(_,s(d).entity_picture)}),z(()=>s(_),()=>{N(w,un(s(_)))}),z(()=>(P(B()),a()),()=>{N(k,B()?a()[B()]:null)}),z(()=>s(k),()=>{N(S,s(k)?`${s(k).state}${s(k).attributes.unit_of_measurement||"°C"}`:null)}),Pe(),Ne();var G=Ma();let le;var X=E(f(G),2),K=f(X),M=f(K),I=f(M),m=f(I);{var y=W=>{Zt(W,{size:16,fill:"currentColor"})},T=W=>{var ye=R(),ae=D(ye);{var he=ge=>{Xt(ge,{size:16,fill:"currentColor"})},ke=ge=>{ua(ge,{size:16})};V(ae,ge=>{s(l)==="paused"?ge(he):ge(ke,!1)},!0)}p(W,ye)};V(m,W=>{s(l)==="playing"?W(y):W(T,!1)})}u(I);var Z=E(I,2),j=f(Z,!0);u(Z),u(M);var F=E(M,2),J=f(F),ce=f(J);Pt(ce,{size:20}),u(J),u(F),u(K);var be=E(K,2),we=f(be),ve=f(we),de=f(ve,!0);u(ve);var C=E(ve,2);{var $=W=>{var ye=Ia(),ae=f(ye,!0);u(ye),Y(()=>x(ae,s(v))),p(W,ye)};V(C,W=>{s(v)&&W($)})}u(we);var ne=E(we,2),fe=f(ne);{var Se=W=>{var ye=Sa(),ae=f(ye);da(ae,{size:14,class:"temp-icon"});var he=E(ae);u(ye),Y(()=>x(he,` ${s(S)??""}`)),p(W,ye)};V(fe,W=>{s(S)&&W(Se)})}var _e=E(fe,2),Re=f(_e);ia(Re,{size:24,fill:"currentColor"}),u(_e);var He=E(_e,2),Ge=f(He);{var at=W=>{Xt(W,{size:32,fill:"currentColor"})},O=W=>{Zt(W,{size:32,fill:"currentColor"})};V(Ge,W=>{s(c)?W(at):W(O,!1)})}u(He);var Oe=E(He,2),rt=f(Oe);oa(rt,{size:24,fill:"currentColor"}),u(Oe),u(ne),u(be),u(X),u(G),Y(()=>{De(G,1,`tile ${s(l)??""} glass-panel`,"svelte-l11nk0"),le=rs(G,"",le,{"--bg-image":s(w)?`url('${s(w)}')`:"none"}),x(j,(P(b()),s(d),q(()=>b()||s(d).friendly_name||"Media"))),x(de,s(g))}),qe("click",J,oe),qe("click",_e,te),qe("click",He,Q),qe("click",Oe,H),p(n,G),Ie(),o()}var Na=U('<div><div class="icon svelte-1kbr3j6"><!></div> <div class="name svelte-1kbr3j6"> </div> <div class="state svelte-1kbr3j6"> </div></div>');function Ca(n,e){Ee(e,!1);const a=()=>ue(Ce,"$entities",i),r=()=>ue(Ae,"$connection",i),[i,o]=Te(),t=A(),l=A();let c=L(e,"entityId",8),d=L(e,"label",8,"");function g(){r()&&ze(r(),"input_boolean","toggle",{entity_id:c()})}z(()=>(a(),P(c())),()=>{N(t,a()[c()])}),z(()=>s(t),()=>{N(l,s(t)?.state==="on")}),Pe(),Ne();var v=Na(),_=f(v),w=f(_);Pt(w,{size:32}),u(_);var k=E(_,2),S=f(k,!0);u(k);var h=E(k,2),b=f(h,!0);u(h),u(v),Y(()=>{De(v,1,is(s(l)?"tile on glass-panel":"tile off glass-panel"),"svelte-1kbr3j6"),x(S,(P(d()),s(t),P(c()),q(()=>d()||s(t)?.attributes.friendly_name||c()))),x(b,(s(t),q(()=>s(t)?.state||"Unknown")))}),qe("click",v,g),p(n,v),Ie(),o()}var Oa=U('<div><div class="icon svelte-tiial9"><!></div> <div class="name svelte-tiial9"> </div> <div class="state svelte-tiial9"> </div></div>');function xa(n,e){Ee(e,!1);const a=()=>ue(Ce,"$entities",i),r=()=>ue(Ae,"$connection",i),[i,o]=Te(),t=A(),l=A();let c=L(e,"entityId",8),d=L(e,"label",8,"");function g(){if(!r())return;const B=s(l)?"turn_off":"turn_on";ze(r(),"homeassistant",B,{entity_id:c()})}z(()=>(a(),P(c())),()=>{N(t,a()[c()])}),z(()=>s(t),()=>{N(l,s(t)?.state==="on")}),Pe(),Ne();var v=Oa(),_=f(v),w=f(_);Pt(w,{size:32}),u(_);var k=E(_,2),S=f(k,!0);u(k);var h=E(k,2),b=f(h,!0);u(h),u(v),Y(()=>{De(v,1,`tile ${s(l)?"on":"off"} glass-panel`,"svelte-tiial9"),x(S,(P(d()),s(t),P(c()),q(()=>d()||s(t)?.attributes.friendly_name||c()))),x(b,(s(t),q(()=>s(t)?.state||"Unknown")))}),qe("click",v,g),p(n,v),Ie(),o()}var Aa=U('<h3 class="title svelte-3p7m1a"> </h3>'),Da=U(', <span class="active-count svelte-3p7m1a"> </span>',1),Pa=U(', <span class="unavailable-count svelte-3p7m1a"> </span>',1),Ua=U('<div class="summary svelte-3p7m1a"> <!> <!></div>'),La=U('<div class="header svelte-3p7m1a"><!> <!></div>'),za=U('<div class="empty-state svelte-3p7m1a"><p>No sensors available</p></div>'),Ra=U('<div><div class="icon svelte-3p7m1a"><!></div> <div class="name svelte-3p7m1a"> </div> <div class="state svelte-3p7m1a"> </div></div>'),Ha=U('<div class="status-grid svelte-3p7m1a"></div>'),ja=U('<div class="status-grid-container svelte-3p7m1a"><!> <!></div>');function Fa(n,e){Ee(e,!1);const a=()=>ue(Ce,"$entities",r),[r,i]=Te(),o=A(),t=A();let l=L(e,"entityIds",24,()=>[]),c=L(e,"labels",24,()=>({})),d=L(e,"deviceClass",8,"door"),g=L(e,"deviceClasses",24,()=>({})),v=L(e,"title",8,""),_=L(e,"showSummary",8,!1),w=L(e,"hideUnavailable",8,!1),k=L(e,"sortByState",8,!0);function S(M){switch(M){case"door":return"Open";case"window":return"Open";case"motion":return"Detected";case"garage":return"Open";case"problem":return"Problem";default:return"On"}}function h(M){switch(M){case"door":return"Closed";case"window":return"Closed";case"motion":return"Clear";case"garage":return"Closed";case"problem":return"OK";default:return"Off"}}function b(M){switch(M){case"door":return fn;case"window":return _t;case"motion":return hn;case"garage":return pt;default:return _n}}function B(M){switch(M){case"door":return vn;case"window":return _t;case"motion":return mt;case"garage":return pt;default:return mt}}function Q(M,I,m){return!M||M==="unavailable"||M==="unknown"?M==="unavailable"?"Unavailable":"Unknown":m?S(I):h(I)}function H(M,I,m){return!M||M==="unavailable"||M==="unknown"?ea:m?b(I):B(I)}z(()=>(P(l()),a(),P(g()),P(d()),P(w()),P(c()),P(k())),()=>{N(o,l().map(M=>{const I=a()[M],m=g()[M]??I?.attributes?.device_class??d(),y=I?.state,T=y==="on",Z=!y||y==="unavailable"||y==="unknown";return w()&&Z?null:{id:M,entity:I,label:c()[M]??I?.attributes?.friendly_name??M,deviceClass:m,state:y,isOn:T,isUnavailable:Z,stateLabel:Q(y,m,T),IconComponent:H(y,m,T)}}).filter(M=>M!==null).sort((M,I)=>{if(k()){if(M.isUnavailable&&!I.isUnavailable)return-1;if(!M.isUnavailable&&I.isUnavailable)return 1;if(M.isOn&&!I.isOn)return-1;if(!M.isOn&&I.isOn)return 1}return 0}))}),z(()=>(P(_()),s(o)),()=>{N(t,_()?(()=>{const M=s(o).length,I=s(o).filter(y=>y.isOn).length,m=s(o).filter(y=>y.isUnavailable).length;return{total:M,active:I,unavailable:m}})():null)}),Pe(),Ne();var te=ja(),oe=f(te);{var G=M=>{var I=La(),m=f(I);{var y=j=>{var F=Aa(),J=f(F,!0);u(F),Y(()=>x(J,v())),p(j,F)};V(m,j=>{v()&&j(y)})}var T=E(m,2);{var Z=j=>{var F=Ua(),J=f(F),ce=E(J);{var be=de=>{var C=Da(),$=E(D(C)),ne=f($);u($),Y(()=>x(ne,`${s(t),q(()=>s(t).active)??""} active`)),p(de,C)};V(ce,de=>{s(t),q(()=>s(t).active>0)&&de(be)})}var we=E(ce,2);{var ve=de=>{var C=Pa(),$=E(D(C)),ne=f($);u($),Y(()=>x(ne,`${s(t),q(()=>s(t).unavailable)??""} unavailable`)),p(de,C)};V(we,de=>{s(t),q(()=>s(t).unavailable>0)&&de(ve)})}u(F),Y(()=>x(J,`${s(t),q(()=>s(t).total)??""} ${s(t),q(()=>s(t).total===1?"sensor":"sensors")??""} `)),p(j,F)};V(T,j=>{s(t)&&j(Z)})}u(I),p(M,I)};V(oe,M=>{(v()||s(t))&&M(G)})}var le=E(oe,2);{var X=M=>{var I=za();p(M,I)},K=M=>{var I=Ha();Je(I,5,()=>s(o),We,(m,y)=>{let T=()=>s(y).label,Z=()=>s(y).isOn,j=()=>s(y).isUnavailable,F=()=>s(y).stateLabel,J=()=>s(y).IconComponent;var ce=Ra(),be=f(ce),we=f(be);on(we,J,(ne,fe)=>{fe(ne,{size:24})}),u(be);var ve=E(be,2),de=f(ve,!0);u(ve);var C=E(ve,2),$=f(C,!0);u(C),u(ce),Y(()=>{De(ce,1,`tile glass-panel ${j()?"unavailable":Z()?"active":"inactive"}`,"svelte-3p7m1a"),ut(ce,"title",`${T()??""}: ${F()??""}`),x(de,T()),x($,F())}),p(m,ce)}),u(I),p(M,I)};V(le,M=>{s(o),q(()=>s(o).length===0)?M(X):M(K,!1)})}u(te),p(n,te),Ie(),i()}var qa=U('<div class="header svelte-aryo9e"><div class="title svelte-aryo9e"><!> <span> </span></div></div>'),Va=U('<div class="loading svelte-aryo9e">Loading events...</div>'),Ba=U('<div class="error svelte-aryo9e"> </div>'),Wa=U('<div class="empty svelte-aryo9e">No upcoming events <div class="debug-info" style="font-size: 0.7rem; opacity: 0.5; margin-top: 0.5rem;"> </div></div>'),Ja=U('<span class="time-separator svelte-aryo9e">–</span> ',1),Ga=U('<span class="duration svelte-aryo9e"> </span>'),Ya=U('<div class="event-time svelte-aryo9e"><!> <span> <!></span> <!></div>'),Ka=U('<div class="event-time svelte-aryo9e"><!> <span> </span></div>'),Xa=U('<div class="event-location svelte-aryo9e"><!> <span> </span></div>'),Za=U('<div class="event glass-panel svelte-aryo9e"><div class="event-date-time svelte-aryo9e"><div class="event-date svelte-aryo9e"><!> <span> </span></div> <!></div> <div class="event-title svelte-aryo9e"> </div> <!></div>'),Qa=U('<div class="events-list svelte-aryo9e"></div>'),er=U('<div class="tile calendar glass-panel svelte-aryo9e"><!> <div class="content svelte-aryo9e"><!></div></div>');function tr(n,e){Ee(e,!1);const a=()=>ue(nt,"$connected",i),r=()=>ue(Ae,"$connection",i),[i,o]=Te();let t=L(e,"entityId",8),l=L(e,"label",8,""),c=L(e,"maxEvents",8,5),d=L(e,"daysAhead",8,7),g=L(e,"showTitle",8,!0),v=A([]),_=A(!0),w=A(null),k=null,S=A(!1);async function h(){a()||await new Promise(m=>setTimeout(m,1e3));try{N(_,!0),N(w,null);const m=new Date;m.setHours(0,0,0,0);const y=new Date(Date.now()+d()*24*60*60*1e3);y.setHours(23,59,59,999),console.log("Calendar date range:",{start:m.toISOString(),end:y.toISOString(),daysAhead:d()});const T=await Ks(t(),m,y);console.log("Fetched events:",T),console.log("Number of events:",T.length),T.length>0&&console.log("First event:",T[0]),N(v,T.sort((Z,j)=>{const F=new Date(Z.start?.dateTime||Z.start?.date||0),J=new Date(j.start?.dateTime||j.start?.date||0);return F.getTime()-J.getTime()}).slice(0,c())),console.log("Processed events:",s(v).length)}catch(m){const y=m.message||"Failed to load events";N(w,y),console.error("Calendar fetch error:",m),console.error("Entity ID:",t()),console.error("Error details:",{message:m.message,stack:m.stack,name:m.name}),N(v,[])}finally{N(_,!1)}}function b(m){const y=m.start?.date||m.start?.dateTime||m.start_time||m.dtstart||m.start;return y?typeof y=="string"&&!y.includes("T")&&!y.includes(" ")&&!!y.match(/^\d{4}-\d{2}-\d{2}$/):!1}function B(m){const y=m.start?.dateTime||m.start?.date||m.start_time||m.dtstart||m.start;if(!y)return console.warn("No start date found in event:",m),"";try{const T=new Date(y);if(isNaN(T.getTime()))return console.warn("Invalid date:",y),"";const Z=new Date,j=new Date(Z.getFullYear(),Z.getMonth(),Z.getDate()),F=new Date(T.getFullYear(),T.getMonth(),T.getDate());if(F.getTime()===j.getTime())return"Today";const J=new Date(j);if(J.setDate(J.getDate()+1),F.getTime()===J.getTime())return"Tomorrow";const ce=Math.floor((F.getTime()-j.getTime())/(1e3*60*60*24));return ce>=0&&ce<7?T.toLocaleDateString("en-US",{weekday:"long"}):T.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}catch(T){return console.error("Error formatting date:",T,y),""}}function Q(m){const y=m.start?.dateTime||m.start?.date||m.start_time||m.dtstart||m.start;if(!y)return"";if(b(m))return"All day";try{const T=new Date(y);return isNaN(T.getTime())?"":T.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(T){return console.error("Error formatting time:",T,y),""}}function H(m){const y=m.end?.dateTime||m.end?.date||m.end_time||m.dtend||m.end;if(!y||b(m))return"";try{const T=new Date(y);return isNaN(T.getTime())?"":T.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(T){return console.error("Error formatting end time:",T,y),""}}function te(m){const y=m.start?.dateTime||m.start?.date,T=m.end?.dateTime||m.end?.date;if(!y||!T)return"";const Z=new Date(y),F=new Date(T).getTime()-Z.getTime(),J=F/(1e3*60*60);return J<1?`${Math.round(F/6e4)}m`:J<24?`${Math.round(J*10)/10}h`:`${Math.round(J/24)}d`}Qt(()=>{h(),k=setInterval(()=>{N(S,!1),h()},300*1e3)}),Pn(()=>{k&&clearInterval(k)}),z(()=>(a(),r(),s(S)),()=>{a()&&r()&&!s(S)&&(N(S,!0),h())}),Pe(),Ne();var oe=er(),G=f(oe);{var le=m=>{var y=qa(),T=f(y),Z=f(T);Yt(Z,{size:18});var j=E(Z,2),F=f(j,!0);u(j),u(T),u(y),Y(()=>x(F,l()||"Calendar")),p(m,y)};V(G,m=>{g()&&m(le)})}var X=E(G,2),K=f(X);{var M=m=>{var y=Va();p(m,y)},I=m=>{var y=R(),T=D(y);{var Z=F=>{var J=Ba(),ce=f(J,!0);u(J),Y(()=>x(ce,s(w))),p(F,J)},j=F=>{var J=R(),ce=D(J);{var be=ve=>{var de=Wa(),C=E(f(de)),$=f(C);u(C),u(de),Y(()=>x($,`Events fetched: ${s(v),q(()=>s(v).length)??""}`)),p(ve,de)},we=ve=>{var de=Qa();Je(de,5,()=>s(v),We,(C,$)=>{var ne=Za(),fe=f(ne),Se=f(fe),_e=f(Se);Yt(_e,{size:12});var Re=E(_e,2),He=f(Re,!0);u(Re),u(Se);var Ge=E(Se,2);{var at=ae=>{var he=Ya(),ke=f(he);Kt(ke,{size:12});var ge=E(ke,2),je=f(ge),xe=E(je);{var vt=Me=>{var $e=Ja(),Ye=E(D($e));Y(it=>x(Ye,` ${it??""}`),[()=>(s($),q(()=>H(s($))))]),p(Me,$e)};V(xe,Me=>{s($),q(()=>H(s($)))&&Me(vt)})}u(ge);var bt=E(ge,2);{var $t=Me=>{var $e=Ga(),Ye=f($e);u($e),Y(it=>x(Ye,`(${it??""})`),[()=>(s($),q(()=>te(s($))))]),p(Me,$e)};V(bt,Me=>{s($),q(()=>te(s($)))&&Me($t)})}u(he),Y(Me=>x(je,`${Me??""} `),[()=>(s($),q(()=>Q(s($))||"Time TBD"))]),p(ae,he)},O=ae=>{var he=Ka(),ke=f(he);Kt(ke,{size:12});var ge=E(ke,2),je=f(ge,!0);u(ge),u(he),Y(xe=>x(je,xe),[()=>(s($),q(()=>Q(s($))||"All day"))]),p(ae,he)};V(Ge,ae=>{s($),q(()=>!b(s($)))?ae(at):ae(O,!1)})}u(fe);var Oe=E(fe,2),rt=f(Oe,!0);u(Oe);var W=E(Oe,2);{var ye=ae=>{var he=Xa(),ke=f(he);sa(ke,{size:24});var ge=E(ke,2),je=f(ge,!0);u(ge),u(he),Y(()=>x(je,(s($),q(()=>s($).location)))),p(ae,he)};V(W,ae=>{s($),q(()=>s($).location)&&ae(ye)})}u(ne),Y(ae=>{x(He,ae),x(rt,(s($),q(()=>s($).summary||s($).title||"Untitled Event")))},[()=>(s($),q(()=>B(s($))||"Date TBD"))]),p(C,ne)}),u(de),p(ve,de)};V(ce,ve=>{s(v),q(()=>s(v).length===0)?ve(be):ve(we,!1)},!0)}p(F,J)};V(T,F=>{s(w)?F(Z):F(j,!1)},!0)}p(m,y)};V(K,m=>{s(_)?m(M):m(I,!1)})}u(X),u(oe),p(n,oe),Ie(),o()}var nr=U('<div class="status error svelte-1uha8ag"> </div>'),sr=U("<div> </div>"),ar=U('<div><div class="people"><div class="people-grid svelte-1uha8ag"></div></div></div>'),rr=U('<div class="status-grid-wrapper svelte-1uha8ag"><!></div>'),ir=U('<div class="calendar-tile-wrapper svelte-1uha8ag"><!></div>'),or=U('<section class="section svelte-1uha8ag"><h2 class="svelte-1uha8ag"> </h2> <div class="grid svelte-1uha8ag"></div></section>'),lr=U('<div class="debug-item"><strong> </strong> </div>'),cr=U('<div class="dashboard-container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-left svelte-1uha8ag"><div class="clock svelte-1uha8ag"><span class="time svelte-1uha8ag"> </span> <span class="date svelte-1uha8ag"> </span></div> <div class="status-container svelte-1uha8ag"><!> <button class="master-switch glass-panel svelte-1uha8ag" title="Turn Off All Lights &amp; Plugs"><!> <span>All Off</span></button> <button class="dark-mode-toggle glass-panel svelte-1uha8ag"><!></button></div></div> <!></header> <main><main><!> <section class="section svelte-1uha8ag"><h2 class="svelte-1uha8ag">Debug: Available People</h2> <div class="debug-list svelte-1uha8ag"></div></section></main></main></div>');function yr(n,e){Ee(e,!0);const a=()=>ue(Ae,"$connection",t),r=()=>ue(Ce,"$entities",t),i=()=>ue(Ve,"$connectionError",t),o=()=>ue(nt,"$connected",t),[t,l]=Te();let c=qt(ss(new Date)),d=me(()=>s(c).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})),g=me(()=>s(c).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})),v=qt(!1);function _(){N(v,!s(v)),typeof window<"u"&&(localStorage.setItem("darkMode",s(v).toString()),document.documentElement.classList.toggle("dark",s(v)))}Qt(()=>{console.log("Alakazam Dashboard: Initializing..."),console.log("Current URL:",typeof window<"u"?window.location.href:"N/A");try{Ys()}catch($){console.error("Error connecting to HA:",$)}const C=setInterval(()=>{N(c,new Date,!0)},1e3);if(typeof window<"u"){const $=localStorage.getItem("darkMode")==="true";N(v,$),$&&document.documentElement.classList.add("dark")}return()=>clearInterval(C)});function w(){if(!a())return;const C=Object.keys(r()).filter($=>($.startsWith("light.")||$.startsWith("switch."))&&r()[$].state==="on");C.length>0&&ze(a(),"homeassistant","turn_off",{entity_id:C})}const k=[{entityId:"person.artfuldoidger",label:"Mat",batteryEntityId:"sensor.mats_iphone_battery_level"},{entityId:"person.jessi",label:"Jess",batteryEntityId:"sensor.jessi_battery_level"}],S={Security:[{type:"statusGrid",entityIds:["binary_sensor.frontdoor_contact_sensor_contact"],labels:{"binary_sensor.frontdoor_contact_sensor_contact":"Front Door"},deviceClass:"door",showSummary:!1},{type:"arm",entityId:"input_boolean.nighttime_door_warning",label:"Arm Door Sensors"}],Calendar:[{type:"calendar",entityId:"calendar.mat_and_jessi",label:"Upcoming Events",maxEvents:5,daysAhead:1,showTitle:!1}],"Living Room":[{type:"media",entityId:"media_player.living_room_tv",label:"TV"},{type:"switch",entityId:"switch.innr_smart_plug_1",label:"Xmas TreeSmart Plug"}],"Master Bedroom":[{type:"light",entityId:"light.bedroom_lamp",label:"Mat Bedroom Lamp"},{type:"light",entityId:"light.mat_and_jess_light",label:"Mat & Jess Light Strip"},{type:"switch",entityId:"switch.0x0017880108e74ea6",label:"Mat & Jess Smart Plug"},{type:"media",entityId:"media_player.main_bedroom",label:"Apple TV"}],"Kids' Rooms":[{type:"light",entityId:"light.ellies_room",label:"Ellie's Light Bar"},{type:"media",entityId:"media_player.ellie_s_daddy_s_house",label:"Ellie's Yoto",temperatureEntityId:"sensor.ellie_s_daddy_s_house_temperature"},{type:"light",entityId:"light.poppys_light_strip_2",label:"Poppy's Light"},{type:"media",entityId:"media_player.poppy_s_yoto",label:"Poppy's Yoto",temperatureEntityId:"sensor.poppy_s_yoto_temperature"},{type:"light",entityId:"light.bens_bedside_lamp",label:"Ben's Lamp"}],Hallway:[{type:"binary_sensor",entityId:"binary_sensor.frontdoor_contact_sensor_contact",label:"Front Door",deviceClass:"door"},{type:"light",entityId:"light.hallway",label:"Hallway Light"}],Network:[{type:"sensor",entityId:"sensor.ucg_ultra_state",label:"UCG Ultra State"},{type:"sensor",entityId:"sensor.atom",label:"Atom Wifi",unit:"Clients"},{type:"sensor",entityId:"sensor.cerebro",label:"Cerebro Wifi",unit:"Clients"},{type:"sensor",entityId:"sensor.ucg_ultra_ucg_ultra_cpu_temperature",label:"UCG Ultra CPU Temp",unit:"°C"}],"Raspberry Pi Server":[{type:"sensor",entityId:"sensor.system_monitor_last_boot",label:"Last Boot",format:"date"},{type:"sensor",entityId:"sensor.system_monitor_disk_use",label:"Disk Use",unit:"%"},{type:"sensor",entityId:"sensor.system_monitor_disk_free",label:"Disk Free",unit:"GB"},{type:"sensor",entityId:"sensor.system_monitor_processor_temperature",label:"Processor Temp",unit:"°C"}]};var h=cr(),b=f(h),B=f(b),Q=f(B),H=f(Q),te=f(H,!0);u(H);var oe=E(H,2),G=f(oe,!0);u(oe),u(Q);var le=E(Q,2),X=f(le);{var K=C=>{var $=nr(),ne=f($,!0);u($),Y(()=>{ut($,"title",i()),x(ne,i())}),p(C,$)},M=C=>{var $=sr();let ne;var fe=f($,!0);u($),Y(()=>{ne=De($,1,"status svelte-1uha8ag",null,ne,{connected:o()}),x(fe,o()?"Connected":"Connecting...")}),p(C,$)};V(X,C=>{i()?C(K):C(M,!1)})}var I=E(X,2);I.__click=w;var m=f(I);gn(m,{size:20}),as(2),u(I);var y=E(I,2);y.__click=_;var T=f(y);{var Z=C=>{la(C,{size:20})},j=C=>{aa(C,{size:20})};V(T,C=>{s(v)?C(Z):C(j,!1)})}u(y),u(le),u(B);var F=E(B,2);{var J=C=>{var $=ar(),ne=f($),fe=f(ne);Je(fe,21,()=>k,We,(Se,_e)=>{Ea(Se,{get entityId(){return s(_e).entityId},get label(){return s(_e).label},get batteryEntityId(){return s(_e).batteryEntityId}})}),u(fe),u(ne),u($),p(C,$)};V(F,C=>{k.length>0&&C(J)})}u(b);var ce=E(b,2),be=f(ce),we=f(be);Je(we,17,()=>Object.entries(S),We,(C,$)=>{var ne=me(()=>rn(s($),2));let fe=()=>s(ne)[0],Se=()=>s(ne)[1];var _e=or(),Re=f(_e),He=f(Re,!0);u(Re);var Ge=E(Re,2);Je(Ge,21,Se,We,(at,O)=>{var Oe=R(),rt=D(Oe);{var W=ae=>{fa(ae,{get entityId(){return s(O).entityId},get label(){return s(O).label}})},ye=ae=>{var he=R(),ke=D(he);{var ge=xe=>{ga(xe,{get entityId(){return s(O).entityId},get label(){return s(O).label},get unit(){return s(O).unit},get format(){return s(O).format}})},je=xe=>{var vt=R(),bt=D(vt);{var $t=$e=>{ma($e,{get entityId(){return s(O).entityId},get label(){return s(O).label},get deviceClass(){return s(O).deviceClass}})},Me=$e=>{var Ye=R(),it=D(Ye);{var mn=Ke=>{ya(Ke,{get entityId(){return s(O).entityId},get label(){return s(O).label}})},pn=Ke=>{var Ut=R(),yn=D(Ut);{var bn=Xe=>{Ca(Xe,{get entityId(){return s(O).entityId},get label(){return s(O).label}})},$n=Xe=>{var Lt=R(),wn=D(Lt);{var kn=Ze=>{xa(Ze,{get entityId(){return s(O).entityId},get label(){return s(O).label}})},En=Ze=>{var zt=R(),In=D(zt);{var Sn=Qe=>{Ta(Qe,{get entityId(){return s(O).entityId},get label(){return s(O).label},get temperatureEntityId(){return s(O).temperatureEntityId}})},Mn=Qe=>{var Rt=R(),Tn=D(Rt);{var Nn=et=>{var tt=rr(),wt=f(tt);{let kt=me(()=>s(O).entityIds??[]),ot=me(()=>s(O).labels??{}),lt=me(()=>s(O).deviceClass??"door"),Et=me(()=>s(O).deviceClasses??{}),It=me(()=>s(O).title??""),St=me(()=>s(O).showSummary??!1),Mt=me(()=>s(O).hideUnavailable??!1),Tt=me(()=>s(O).sortByState??!0);Fa(wt,{get entityIds(){return s(kt)},get labels(){return s(ot)},get deviceClass(){return s(lt)},get deviceClasses(){return s(Et)},get title(){return s(It)},get showSummary(){return s(St)},get hideUnavailable(){return s(Mt)},get sortByState(){return s(Tt)}})}u(tt),p(et,tt)},Cn=et=>{var tt=R(),wt=D(tt);{var kt=ot=>{var lt=ir(),Et=f(lt);{let It=me(()=>s(O).label??""),St=me(()=>s(O).maxEvents??5),Mt=me(()=>s(O).daysAhead??7),Tt=me(()=>s(O).showTitle!==void 0?s(O).showTitle:!0);tr(Et,{get entityId(){return s(O).entityId},get label(){return s(It)},get maxEvents(){return s(St)},get daysAhead(){return s(Mt)},get showTitle(){return s(Tt)}})}u(lt),p(ot,lt)};V(wt,ot=>{s(O).type==="calendar"&&ot(kt)},!0)}p(et,tt)};V(Tn,et=>{s(O).type==="statusGrid"?et(Nn):et(Cn,!1)},!0)}p(Qe,Rt)};V(In,Qe=>{s(O).type==="media"?Qe(Sn):Qe(Mn,!1)},!0)}p(Ze,zt)};V(wn,Ze=>{s(O).type==="automation"?Ze(kn):Ze(En,!1)},!0)}p(Xe,Lt)};V(yn,Xe=>{s(O).type==="arm"?Xe(bn):Xe($n,!1)},!0)}p(Ke,Ut)};V(it,Ke=>{s(O).type==="switch"?Ke(mn):Ke(pn,!1)},!0)}p($e,Ye)};V(bt,$e=>{s(O).type==="binary_sensor"?$e($t):$e(Me,!1)},!0)}p(xe,vt)};V(ke,xe=>{s(O).type==="sensor"?xe(ge):xe(je,!1)},!0)}p(ae,he)};V(rt,ae=>{s(O).type==="light"?ae(W):ae(ye,!1)})}p(at,Oe)}),u(Ge),u(_e),Y(()=>x(He,fe())),p(C,_e)});var ve=E(we,2),de=E(f(ve),2);Je(de,5,()=>Object.keys(r()).filter(C=>C.startsWith("light.")||C.startsWith("switch.")||C.startsWith("sensor.ucg")),We,(C,$)=>{var ne=lr(),fe=f(ne),Se=f(fe,!0);u(fe);var _e=E(fe);u(ne),Y(()=>{x(Se,s($)),x(_e,`: ${r()[s($)].state??""}`)}),p(C,ne)}),u(de),u(ve),u(be),u(ce),u(h),Y(()=>{x(te,s(d)),x(G,s(g)),ut(y,"title",s(v)?"Switch to Light Mode":"Switch to Dark Mode")}),p(n,h),Ie(),l()}Dn(["click"]);export{yr as component};
